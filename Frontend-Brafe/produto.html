<!DOCTYPE html>
<html>
<head>
	<title>Brafé</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" type="text/css" href="css/menu.css">
	<link rel="stylesheet" type="text/css" href="css/produtos.css">
	<link rel="stylesheet" type="text/css" href="css/footer.css">
</head>
<body>
	<header class="menu">
		<div class="container">
			<a class="menu-logo" href="index.html"><img src="img/brafe.png" alt="Brafé"></a>	
			<nav class="menu-nav">
				<ul>
					<li><a href="login.html">Login</a></li>
					<li><a href="cadastrar.html">Cadastrar</a></li>
					<li><a href="produto.html">Produtos</a></li>
					<li><a href="contato.html">Contato</a></li>
				</ul>
			</nav>
		</div>
	</header>
	<section class="sub-menu">
		<header>
			<h1>Produtos</h1>
			<div>
				<div id="userData"></div>
					<script>
						// Recuperar dados do localStorage
						const userData = JSON.parse(sessionStorage.getItem('userData'));
				
						if (!userData) {
							// Se não houver dados de usuário, redirecionar para a página de login
							window.location.href = 'login.html';
						} else {
							// Exibir os dados do usuário
							document.getElementById('userData').innerText = `Bem-vindo, ${userData.username}`;
						}
					</script>
				</div>
			</div>
		</header>
	</section>
		<section class="produtos">
		<form id="carrinhoForm">
			<ul class="produtos-item">
				<li class="produtos-item">
					<input type="hidden" name="produto1_nome" value="Capuccino">
					<input type="hidden" name="produto1_preco" value="2.45">
					<input type="hidden" name="produto1_dados" value="Café novo no estilo Cappuccino">
					<img src="img/cafe-5.jpg" alt="Café 2">
					<ul>
						<li><span>Nome:</span> Capuccino</li>
						<li><span>Preço:</span> R$ 2,45</li>
						<li><span>Dados:</span> Café novo no estilo Cappuccino</li>
					</ul>
					<div class="quantidade">
						<label for="produto1_quantidade">Quantidade:</label>
						<button type="button" onclick="alterarQuantidade('produto1', -1)">-</button>
						<input type="number" id="produto1_quantidade" name="produto1_quantidade" value="0" min="0">
						<button type="button" onclick="alterarQuantidade('produto1', 1)">+</button>
					</div>
				</li>
		
				<li class="produtos-item">
					<input type="hidden" name="produto2_nome" value="Espresso">
					<input type="hidden" name="produto2_preco" value="1.99">
					<input type="hidden" name="produto2_dados" value="Café forte e encorpado">
					<img src="img/cafe-3.jpg" alt="Café 3">
					<ul>
						<li><span>Nome:</span> Espresso</li>
						<li><span>Preço:</span> R$ 1,99</li>
						<li><span>Dados:</span> Café forte e encorpado</li>
					</ul>
					<div class="quantidade">
						<label for="produto2_quantidade">Quantidade:</label>
						<button type="button" onclick="alterarQuantidade('produto2', -1)">-</button>
						<input type="number" id="produto2_quantidade" name="produto2_quantidade" value="0" min="0">
						<button type="button" onclick="alterarQuantidade('produto2', 1)">+</button>
					</div>
				</li>

				<li class="produtos-item">
					<input type="hidden" name="produto3_nome" value="Nescafe">
					<input type="hidden" name="produto3_preco" value="10.99">
					<input type="hidden" name="produto3_dados" value="Café Nescafe">
					<img src="img/cafe-4.jpg" alt="Café 3">
					<ul>
						<li><span>Nome:</span> Nescafe</li>
						<li><span>Preço:</span> R$ 10,99</li>
						<li><span>Dados:</span> Café Nescafe</li>
					</ul>
					<div class="quantidade">
						<label for="produto3_quantidade">Quantidade:</label>
						<button type="button" onclick="alterarQuantidade('produto3', -1)">-</button>
						<input type="number" id="produto3_quantidade" name="produto3_quantidade" value="0" min="0">
						<button type="button" onclick="alterarQuantidade('produto3', 1)">+</button>
					</div>
				</li>

				<li class="produtos-item">
					<input type="hidden" name="produto4_nome" value="Espresso">
					<input type="hidden" name="produto4_preco" value="1.99">
					<input type="hidden" name="produto4_dados" value="Café forte e encorpado">
					<img src="img/cafe-3.jpg" alt="Café 3">
					<ul>
						<li><span>Nome:</span> Espresso</li>
						<li><span>Preço:</span> R$ 1,99</li>
						<li><span>Dados:</span> Café forte e encorpado</li>
					</ul>
					<div class="quantidade">
						<label for="produto4_quantidade">Quantidade:</label>
						<button type="button" onclick="alterarQuantidade('produto4', -1)">-</button>
						<input type="number" id="produto4_quantidade" name="produto4_quantidade" value="0" min="0">
						<button type="button" onclick="alterarQuantidade('produto4', 1)">+</button>
					</div>
				</li>
			</ul>
		
			<button class="adicionar-produtos" type="submit">Adicionar ao Carrinho</button>
		</form>
		
		<script>
			function alterarQuantidade(produto, delta) {
				const input = document.getElementById(`${produto}_quantidade`);
				let quantidade = parseInt(input.value) + delta;
				if (quantidade < 0) {
					quantidade = 0;
				}
				input.value = quantidade;
			}
		
			document.getElementById('carrinhoForm').addEventListener('submit', async function(event) {
				event.preventDefault();
		
				const formData = new FormData(this);
				const produtos = [];
		
				for (const entry of formData.entries()) {
					const [name, value] = entry;
					if (name.endsWith('_quantidade') || name.endsWith('_manual')) {
						const produto = {};
						const prefix = name.substring(0, name.lastIndexOf('_'));
						produto.nome = formData.get(`${prefix}_nome`);
						produto.preco = formData.get(`${prefix}_preco`);
						produto.dados = formData.get(`${prefix}_dados`);
						produto.quantidade = value;
						produtos.push(produto);
					}
				}
		
				console.log(produtos); // Aqui você pode enviar a lista 'produtos' para o backend

					// Envie os dados para o backend
					try {
                            const response = await fetch('http://localhost:8080/carrinho', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ produtos })
                            });
						console.log(response.status === 200)
						if (response.status === 200) {
                                const data = await response.json();
                                // Salvar dados no sessionStorage
                                sessionStorage.setItem('carrinhoData', JSON.stringify(data));
                                window.location.href = 'carrinho.html';
                            } else {
                                alert('Login failed');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('An error occurred');
                        }
                    });
		</script>
	</section>


	<section class="assine">
		<div class="container">
			<div class="assine-info">
				<h2>Assine Nossa Newsletter</h2>
				<p>promoções e eventos mensais</p>
			</div>
			<form>
				<label>E-mail</label>
				<input type="text" placeholder="Digite seu e-mail">
				<button type="submit">Enviar</button>
			</form>
		</div>
	</section>
	
	<footer class="footer">
		<div class="container">
			<p>Este é um projeto PIT. Matheus do Prado Marques da Costa. <br>RGM: 23867078. <br>Faculdade: Unifran.</p>
			<div class="footer-img">
				<img src="img/brafe.png" alt="Brafé">
			</div>
		</div>
	</footer>
	
</body>
</html>















